

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Examples &mdash; pycopm  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pycopm Python API" href="api.html" />
    <link rel="prev" title="Configuration file" href="configuration_file.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #aaaaaa" >

          
          
          <a href="index.html">
            
              <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration_file.html">Configuration file</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#via-configuration-files">Via configuration files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#via-opm-flow-decks">Via OPM Flow decks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hello-world">Hello world</a></li>
<li class="toctree-l3"><a class="reference internal" href="#smeaheia">Smeaheia</a></li>
<li class="toctree-l3"><a class="reference internal" href="#drogon">Drogon</a></li>
<li class="toctree-l3"><a class="reference internal" href="#norne">Norne</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spe10">SPE10</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#graphical-abstract">Graphical abstract</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">pycopm Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_folder.html">Output folder</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="related.html">Related</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About pycopm</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #aaaaaa" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pycopm</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/examples.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h1>
<p>For additional examples demonstrating the applicability of <strong>pycopm</strong>, see the <a class="reference external" href="https://github.com/cssr-tools/pycopm/tree/main/tests">tests</a>.
<a class="reference external" href="https://resinsight.org">ResInsight</a> and <a class="reference external" href="https://github.com/cssr-tools/plopm">plopm</a> are used for the visualization of the results.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For macOS users, you could try to install ResInsight following <a class="reference external" href="https://github.com/SoilRos/homebrew-OPM">this</a>. If you have issues
installing ResInsight, <a class="reference external" href="https://www.paraview.org">ParaView</a> can be also used. However, you need to add the flag <strong>--enable-vtk-output=true</strong>
to OPM Flow.</p>
</div>
<section id="via-configuration-files">
<h2>Via configuration files<a class="headerlink" href="#via-configuration-files" title="Link to this heading"></a></h2>
<p>The <a class="reference external" href="https://github.com/cssr-tools/pycopm/blob/main/examples/configurations">examples</a> folder contains configuration files
to perform HM studies in drogon and norne using <a class="reference external" href="https://ert.readthedocs.io/en/latest/">ERT</a>. For example, by executing inside the <a class="reference external" href="https://github.com/cssr-tools/pycopm/blob/main/examples/configurations/drogon">example folder for drogon</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># From inside the main pycopm folder</span>
<span class="nb">cd</span><span class="w"> </span>examples/configurations/drogon
pycopm<span class="w"> </span>-i<span class="w"> </span>input.toml<span class="w"> </span>-o<span class="w"> </span>drogon_coarser
</pre></div>
</div>
<p>The following are the drogon model from <a class="reference external" href="https://github.com/OPM/opm-tests/tree/master/drogon">opm-tests</a> and coarsened model generated using <strong>pycopm</strong>:</p>
<figure class="align-default">
<img alt="_images/drogon_coarser.png" src="_images/drogon_coarser.png" />
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Drogon, a scored is printed after the run to compared the error to the results available at
<a class="reference external" href="https://webviz-subsurface-example.azurewebsites.net/history-match">https://webviz-subsurface-example.azurewebsites.net/history-match</a>. While <a class="reference external" href="https://github.com/cssr-tools/pycopm/blob/main/examples/configurations/drogon/input.toml">input.toml</a>
only runs a single simulation that is used in testing <strong>pycopm</strong>, <a class="reference external" href="https://github.com/cssr-tools/pycopm/blob/main/examples/configurations/drogon/hm.toml">hm.toml</a> runs a history matching
with a better score (i.e., less error compare to the observation data). This configuration file is also an example of how to use mpi to run Flow built from source
(set the flow path to your flow location; if you do not have mpi, you can remove it and still run the example).</p>
</div>
</section>
<section id="via-opm-flow-decks">
<span id="generic"></span><h2>Via OPM Flow decks<a class="headerlink" href="#via-opm-flow-decks" title="Link to this heading"></a></h2>
<p>The current development of <strong>pycopm</strong> focuses on creating tailored models (grid refinement, grid coarsening, submodels, and transformations) by using input decks.
While in the Hello world example these four different options are demonstrated, for the latter examples the focus is on the grid coarsening functionality, and the
SPE10 also shows the submodel functionality.</p>
<section id="hello-world">
<h3>Hello world<a class="headerlink" href="#hello-world" title="Link to this heading"></a></h3>
<p>For the <a class="reference external" href="https://github.com/cssr-tools/pycopm/blob/main/examples/decks/HELLO_WORLD.DATA">HELLO_WORLD.DATA</a> deck, by executing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># From inside the main pycopm folder</span>
<span class="nb">cd</span><span class="w"> </span>examples/decks
pycopm<span class="w"> </span>-i<span class="w"> </span>HELLO_WORLD.DATA<span class="w"> </span>-c<span class="w"> </span><span class="m">5</span>,5,1<span class="w"> </span>-m<span class="w"> </span>all<span class="w"> </span>-o<span class="w"> </span>output
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the folder to flow is not added to your path, then pass the full path to the flow executable using the flag <strong>-f /path/to/flow</strong>.</p>
</div>
<p>Using <a class="reference external" href="https://resinsight.org">ResInsight</a>, then we can visualize the generated files in the output folder:</p>
<figure class="align-default" id="id12">
<img alt="_images/hello_world_1.png" src="_images/hello_world_1.png" />
<figcaption>
<p><span class="caption-text">Dry run from the input cloned deck (left) and (right) coarsened model. Adding the flag <strong>-p 1</strong> adds the remove pore volume to the neighbouring cells.</span><a class="headerlink" href="#id12" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>As mentioned above, if you do not have ResInsight, then to visualize the results in ParaView run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flow<span class="w"> </span>HELLO_WORLD.DATA<span class="w"> </span>--enable-vtk-output<span class="o">=</span><span class="nb">true</span>
flow<span class="w"> </span>HELLO_WORLD_PYCOPM.DATA<span class="w"> </span>--enable-vtk-output<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>To make active the coarsened cell where there is only one active cell, this can be achieved by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pycopm<span class="w"> </span>-i<span class="w"> </span>HELLO_WORLD.DATA<span class="w"> </span>-c<span class="w"> </span><span class="m">5</span>,5,1<span class="w"> </span>-m<span class="w"> </span>all<span class="w"> </span>-a<span class="w"> </span>max
</pre></div>
</div>
<figure class="align-default" id="id13">
<img alt="_images/hello_world_2.png" src="_images/hello_world_2.png" />
<figcaption>
<p><span class="caption-text">Dry run from the input cloned deck (left) and (right) coarsened model. The region numbers by default are given by the mode, e.g., use the flag <strong>-n max</strong> to keep the maximum integer.</span><a class="headerlink" href="#id13" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>As described in the <a class="reference internal" href="theory.html"><span class="doc">theory</span></a>, <strong>pycopm</strong> can be not only used for grid coarsening, but also to apply grid refinements, submodels, and transformations.
Then, with the following commands first we substract a submodel around the isolated grid cell proyecting the outside pore volume on the boundaries, after
we apply a grid refinement on the cells in the middle x and y location, and finally we rotate the model 45 degrees.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pycopm<span class="w"> </span>-i<span class="w"> </span>HELLO_WORLD.DATA<span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;xypolygon [4,8.5] [4,16.5] [11.5,16.5] [11.5,8.5]&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="m">1</span><span class="w"> </span>-m<span class="w"> </span>all
pycopm<span class="w"> </span>-i<span class="w"> </span>HELLO_WORLD_PYCOPM.DATA<span class="w"> </span>-rx<span class="w"> </span><span class="m">0</span>,0,0,2,0,0,0<span class="w"> </span>-ry<span class="w"> </span><span class="m">0</span>,0,0,2,0,0,0<span class="w"> </span>-m<span class="w"> </span>all
pycopm<span class="w"> </span>-i<span class="w"> </span>HELLO_WORLD_PYCOPM_PYCOPM.DATA<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;rotatexy 45&#39;</span><span class="w"> </span>-m<span class="w"> </span>all
</pre></div>
</div>
<figure class="align-default" id="id14">
<img alt="_images/hello_world_3.png" src="_images/hello_world_3.png" />
<figcaption>
<p><span class="caption-text">Extracted region with the projected pore volumes (bottom left), refinement around the center cells (top right), and rotation (bottom right).
The text in the legends highlight that the pore volume is conserved (35.58) and the number of active cells is reduced from 351 to 25 in the
submodel and after increased to 41 due to the grid refinement.</span><a class="headerlink" href="#id14" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To write the cell values for the SOLUTION section instead of using the EQUIL keyword, this can be achieved by the flag <strong>-explicit 1</strong>; the
only requirement is that the EQUIL keyword needs to be in the main input DATA file and no via INCLUDE files.</p>
</div>
</section>
<section id="smeaheia">
<h3>Smeaheia<a class="headerlink" href="#smeaheia" title="Link to this heading"></a></h3>
<p>By downloading the <a class="reference external" href="https://co2datashare.org/dataset/smeaheia-dataset">Smeaheia simulation model</a> (dataset part Simulation models),
then:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># From the download folders</span>
<span class="nb">cd</span><span class="w"> </span>Simulation_Models/data
pycopm<span class="w"> </span>-c<span class="w"> </span><span class="m">5</span>,4,3<span class="w"> </span>-a<span class="w"> </span>min<span class="w"> </span>-m<span class="w"> </span>all<span class="w"> </span>-i<span class="w"> </span>Statoil_Feasibility_sim_model_with_depletion_KROSS_INJ_SECTOR_20.DATA<span class="w"> </span>-o<span class="w"> </span>.
</pre></div>
</div>
<p>will generate a coarser model five times in the x direction, four in the y direction, and three in the z direction, where the coarse cell is
made inactive if at least one cell is inactive (<strong>-a min</strong>).</p>
<p>We use our <a class="reference external" href="https://github.com/cssr-tools/plopm">plopm</a> friend to generate PNG figures:</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can install <a class="reference external" href="https://github.com/cssr-tools/plopm">plopm</a> by executing in the terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/cssr-tools/plopm.git
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>plopm<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;STATOIL_FEASIBILITY_SIM_MODEL_WITH_DEPLETION_KROSS_INJ_SECTOR_20_PREP_PYCOPM_DRYRUN STATOIL_FEASIBILITY_SIM_MODEL_WITH_DEPLETION_KROSS_INJ_SECTOR_20_PYCOPM&#39;</span><span class="w"> </span>-s<span class="w"> </span>,,0<span class="w"> </span>-v<span class="w"> </span>poro<span class="w"> </span>-subfigs<span class="w"> </span><span class="m">1</span>,2<span class="w"> </span>-save<span class="w"> </span>smeaheia<span class="w"> </span>-t<span class="w"> </span><span class="s1">&#39;Smeaheia  Coarsened Smeaheia&#39;</span><span class="w"> </span>-delax<span class="w"> </span><span class="m">1</span><span class="w"> </span>-xunits<span class="w"> </span>km<span class="w"> </span>-xformat<span class="w"> </span>.0f<span class="w"> </span>-yunits<span class="w"> </span>km<span class="w"> </span>-yformat<span class="w"> </span>.0f<span class="w"> </span>-d<span class="w"> </span><span class="m">5</span>,4.5<span class="w"> </span>-suptitle<span class="w"> </span><span class="m">0</span><span class="w"> </span>-c<span class="w"> </span>cet_rainbow_bgyrm_35_85_c69<span class="w"> </span>-cbsfax<span class="w"> </span><span class="m">0</span>.2,0.95,0.6,0.02<span class="w"> </span>-cformat<span class="w"> </span>.2f
</pre></div>
</div>
<figure class="align-default" id="id15">
<img alt="_images/smeaheia.png" src="_images/smeaheia.png" />
<figcaption>
<p><span class="caption-text">Top view of porosity values for the (left) original and (right) coarsened model (note that we also apply the coarsening on the z direction).</span><a class="headerlink" href="#id15" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="drogon">
<span id="id5"></span><h3>Drogon<a class="headerlink" href="#drogon" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the current implementation of the <strong>pycopm</strong> tool, the handling of properties that requires definitions of i,j,k indices
(e.g., FAULTS, WELLSPECS) are assumed to be defined in the main .DATA deck. Then, in order to use <strong>pycopm</strong> for simulation models
where these properties are define via include files, replace those includes in the .DATA deck with the actual content of the include files.
Here are some relevant keywords per deck section that need to be in the main input deck and not via include files:</p>
<p>SECTION GRID: MAPAXES, FAULTS, MULTREGT (other keywords like MULTZ, NTG, or definitions/operations for perms and poro can be in included files since
permx, permy, permz, poro, porv, multx, multy, multz are read from the .INIT file)</p>
<p>SECTION PROPS: EQUALS, COPY, ADD, and MULTIPLY since this involve i,j,k indices and are applied to properties such as saturation functions parameters that
are still given in the same input format in the generated deck. In addition, SWATINIT if used in the deck, is read from the .INIT file and output for the
modified deck in a new file, then one might need to give the right include path to this special case.</p>
<p>SECTION SCHEDULE: All keywords in this section must be in the input deck and no via include viles.</p>
</div>
<p>Following the note above, then by downloading the <a class="reference external" href="https://github.com/OPM/opm-tests/tree/master/drogon">DROGON model</a>, adding the <a class="reference external" href="https://raw.githubusercontent.com/OPM/opm-tests/master/drogon/include/grid/drogon.grid">MAPAXES</a>
to the deck, replacing the lines in <a class="reference external" href="https://github.com/OPM/opm-tests/blob/master/drogon/model/DROGON_HIST.DATA">DROGON_HIST.DATA</a> for the FAULTS (L127-128) and SCHEDULE (L242-243) with the actual content of those include files, then by executing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pycopm<span class="w"> </span>-i<span class="w"> </span>DROGON_HIST.DATA<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>,1,3<span class="w"> </span>-p<span class="w"> </span><span class="m">1</span><span class="w"> </span>-q<span class="w"> </span><span class="m">1</span><span class="w"> </span>-l<span class="w"> </span>C1
pycopm<span class="w"> </span>-i<span class="w"> </span>DROGON_HIST_PYCOPM.DATA<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>,3,1<span class="w"> </span>-p<span class="w"> </span><span class="m">1</span><span class="w"> </span>-q<span class="w"> </span><span class="m">1</span><span class="w"> </span>-j<span class="w"> </span><span class="m">2</span>.5<span class="w"> </span>-l<span class="w"> </span>C2<span class="w"> </span>-m<span class="w"> </span>all
</pre></div>
</div>
<p>this would generate the following coarsened model:</p>
<figure class="align-default" id="id16">
<img alt="_images/drogon_generic.png" src="_images/drogon_generic.png" />
<figcaption>
<p><span class="caption-text">Note that the total pore volume is conserved for the coarsened model (right). The properties of the standard model (left) can be visualized using the DROGON_HIST_PREP_PYCOPM_DRYRUN generated files.</span><a class="headerlink" href="#id16" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Here, we first coarse in the z direction, which reduces the number of cells from 31 to 11, and after we coarse in the y direction.
After trial and error, the jump (<strong>-j</strong>) is set to 2.5 to avoid generated connections across the faults. For geological models with a lot of
inactive cells and faults, this divide and conquer apporach is recommended, i.e., coarsening first in the z direction and after coarsening
in the x and y directions. Also, we add labels (<strong>-l</strong>) C1 and C2 to differentiate between the coarse include files. In addition, we use the
flags <strong>-p 1 -q 1</strong> to add the remove pore volume to the closest coarser cells and to redistribute the pore volume in the locations with
gas and oil, this results in the coarsened model having the same total pore volume, field gas in place, and practically same oil and water in
place as the input model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Add to the generated deck the removed include files in the grid section related to the region operations (e.g.,
../include/grid/drogon.multregt for this case).</p>
</div>
<p>Now, we also show a two times coarsened model in all directions (referring to the previous comment about divide and conquer, for the Drogon model
it seems still ok to do a two times coarsening in one go):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pycopm<span class="w"> </span>-i<span class="w"> </span>DROGON_HIST.DATA<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span>,2,2<span class="w"> </span>-p<span class="w"> </span><span class="m">1</span><span class="w"> </span>-q<span class="w"> </span><span class="m">1</span><span class="w"> </span>-j<span class="w"> </span><span class="m">4</span><span class="w"> </span>-w<span class="w"> </span>DROGON_2TIMES_COARSER<span class="w"> </span>-m<span class="w"> </span>all
</pre></div>
</div>
<p>Here, we use the <strong>-w</strong> flag to give a specific name to the generated coarsened deck, as well as using a higher value of <strong>-j</strong> to avoid generated connections across the faults.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To use a different approach from the default ones (see the <a class="reference internal" href="theory.html"><span class="doc">theory</span></a>) to coarse one of the properties (e.g., permeabilities), this can
be achieve by the <strong>-s</strong> flag, e.g., <strong>-s pvmean</strong> to coarse the permeabilities using a pv-weighted mean. In addition, one could add a different label
<strong>-l pvweightedperms</strong> to identify the generated .INC files with the permeabilities, and rename these files in order to be used in the coarserned model with the rest
of the properties using the default aproaches or a combination of them (e.g., <strong>-s max -l maxpermz</strong> and keep the maximum values of permz).</p>
</div>
<p>If we run these three models using OPM Flow:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flow<span class="w"> </span>DROGON_HIST.DATA
flow<span class="w"> </span>DROGON_HIST_PYCOPM_PYCOPM
flow<span class="w"> </span>DROGON_2TIMES_COARSER
</pre></div>
</div>
<p>then we can compare the summary vectors. To this end, we use our good old friend <a class="reference external" href="https://github.com/cssr-tools/plopm">plopm</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>plopm<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;DROGON_HIST DROGON_HIST_PYCOPM_PYCOPM DROGON_2TIMES_COARSER&#39;</span><span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;FOIP,FOPR,TCPU&#39;</span><span class="w"> </span>-tunits<span class="w"> </span>y<span class="w"> </span>-f<span class="w"> </span><span class="m">14</span><span class="w"> </span>-subfigs<span class="w"> </span><span class="m">2</span>,2<span class="w"> </span>-delax<span class="w"> </span><span class="m">1</span><span class="w"> </span>-loc<span class="w"> </span>empty,empty,empty,center<span class="w"> </span>-d<span class="w"> </span><span class="m">10</span>,5<span class="w"> </span>-xformat<span class="w"> </span><span class="s1">&#39;.1f&#39;</span><span class="w"> </span>-xlnum<span class="w"> </span><span class="m">6</span><span class="w"> </span>-ylabel<span class="w"> </span><span class="s1">&#39;sm$^3$  sm$^3$/day  seconds&#39;</span><span class="w"> </span>-t<span class="w"> </span><span class="s1">&#39;Field oil in place  Field oil production rate  Simulation time&#39;</span><span class="w"> </span>-labels<span class="w"> </span><span class="s1">&#39;DROGON  DROGON 3XZ COARSER  DROGON 2XYZ COARSER&#39;</span><span class="w"> </span>-save<span class="w"> </span>drogon_pycopm_comparison<span class="w"> </span>-yformat<span class="w"> </span><span class="s1">&#39;.2e,.0f,.0f&#39;</span>
</pre></div>
</div>
<figure class="align-default" id="id17">
<img alt="_images/drogon_pycopm_comparison.png" src="_images/drogon_pycopm_comparison.png" />
<figcaption>
<p><span class="caption-text">Note that the coarsened models have the same initial field oil in place as the input model. It seems the coarsened properties (e.g., permeabilities)
are good initial inputs to use in a history matching framework (e.g., to history match saturation function parameters), and the lower simulation
time for the coarsened models allow for more ensemble members and more iterations.</span><a class="headerlink" href="#id17" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>We can also make a nice GIF by executing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>plopm<span class="w"> </span>-v<span class="w"> </span>sgas<span class="w"> </span>-subfigs<span class="w"> </span><span class="m">1</span>,3<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;DROGON_HIST DROGON_HIST_PYCOPM_PYCOPM DROGON_2TIMES_COARSER&#39;</span><span class="w"> </span>-d<span class="w"> </span><span class="m">16</span>,10.5<span class="w"> </span>-m<span class="w"> </span>gif<span class="w"> </span>-dpi<span class="w"> </span><span class="m">300</span><span class="w"> </span>-t<span class="w"> </span><span class="s2">&quot;DROGON  DROGON 3XZ COARSER  DROGON 2XYZ COARSER&quot;</span><span class="w"> </span>-f<span class="w"> </span><span class="m">16</span><span class="w"> </span>-interval<span class="w"> </span><span class="m">2000</span><span class="w"> </span>-loop<span class="w"> </span><span class="m">1</span><span class="w"> </span>-cformat<span class="w"> </span>.2f<span class="w"> </span>-cbsfax<span class="w"> </span><span class="m">0</span>.30,0.01,0.4,0.02<span class="w"> </span>-s<span class="w"> </span>,,1<span class="w"> </span>-rotate<span class="w"> </span>-30<span class="w"> </span>-xunits<span class="w"> </span>km<span class="w"> </span>-yunits<span class="w"> </span>km<span class="w"> </span>-xformat<span class="w"> </span>.0f<span class="w"> </span>-yformat<span class="w"> </span>.0f<span class="w"> </span>-c<span class="w"> </span>cet_rainbow_bgyrm_35_85_c69<span class="w"> </span>-delax<span class="w"> </span><span class="m">1</span><span class="w"> </span>-r<span class="w"> </span><span class="m">0</span>:3
</pre></div>
</div>
<figure class="align-default" id="id18">
<img alt="_images/sgas.gif" src="_images/sgas.gif" />
<figcaption>
<p><span class="caption-text">Top view of the Drogon and the two coarsened models</span><a class="headerlink" href="#id18" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="norne">
<h3>Norne<a class="headerlink" href="#norne" title="Link to this heading"></a></h3>
<p>By downloading the <a class="reference external" href="https://github.com/OPM/opm-tests/tree/master/norne">Norne model</a> (and replacing the needed include files as described in the previous
example, specially the include file <a class="reference external" href="https://github.com/OPM/opm-tests/blob/master/norne/INCLUDE/BC0407_HIST01122006.SCH">./INCLUDE/BC0407_HIST01122006.SCH</a> at the end of <a class="reference external" href="https://github.com/OPM/opm-tests/blob/master/norne/NORNE_ATW2013.DATA">NORNE_ATW2013.DATA</a> to run the example without errors),
then here we create a coarsened model by removing certain pilars in order to keep the main features of the geological model:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pycopm<span class="w"> </span>-i<span class="w"> </span>NORNE_ATW2013.DATA<span class="w"> </span>-s<span class="w"> </span>pvmean<span class="w"> </span>-x<span class="w"> </span><span class="m">0</span>,2,0,2,2,0,2,0,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,0,2,0,2,2,0,2,2,0,2,2,2,2,0<span class="w"> </span>-y<span class="w"> </span><span class="m">0</span>,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,2,2,2,2,2,2,2,2,0<span class="w"> </span>-z<span class="w"> </span><span class="m">0</span>,0,2,0,0,2,2,2,2,2,0,2,2,2,2,2,0,0,2,0,2,2,0<span class="w"> </span>-a<span class="w"> </span>min<span class="w"> </span>-p<span class="w"> </span><span class="m">1</span><span class="w"> </span>-q<span class="w"> </span><span class="m">1</span><span class="w"> </span>-m<span class="w"> </span>all
</pre></div>
</div>
<p>this would generate the following coarsened model:</p>
<figure class="align-default">
<img alt="_images/norne_vec.png" src="_images/norne_vec.png" />
</figure>
</section>
<section id="spe10">
<span id="id7"></span><h3>SPE10<a class="headerlink" href="#spe10" title="Link to this heading"></a></h3>
<p>By downloading the <a class="reference external" href="https://github.com/OPM/opm-data/tree/master/spe10model2">SPE10_MODEL2 model</a>, then:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pycopm<span class="w"> </span>-i<span class="w"> </span>SPE10_MODEL2.DATA<span class="w"> </span>-s<span class="w"> </span>pvmean<span class="w"> </span>-c<span class="w"> </span><span class="m">4</span>,8,2<span class="w"> </span>-m<span class="w"> </span>all
</pre></div>
</div>
<p>generates a coarsened model from ca. 1 million cells to ca. 20 thousands cells.</p>
<figure class="align-default" id="id19">
<img alt="_images/spe10_model2_coarser.png" src="_images/spe10_model2_coarser.png" />
<figcaption>
<p><span class="caption-text">Porosity values for the (left) original and (right) coarsed SPE10 model.</span><a class="headerlink" href="#id19" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>To generate a submodel from the coarsened model around the injector ‘INJ’, this can be achieved by executing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pycopm<span class="w"> </span>-i<span class="w"> </span>SPE10_MODEL2_PYCOPM.DATA<span class="w"> </span>-p<span class="w"> </span><span class="m">1</span><span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;INJ diamondxy 5&#39;</span><span class="w"> </span>-m<span class="w"> </span>all<span class="w"> </span>-w<span class="w"> </span>vicinity<span class="w"> </span>-l<span class="w"> </span>sub<span class="w"> </span>-m<span class="w"> </span>all
</pre></div>
</div>
<figure class="align-default" id="id20">
<img alt="_images/vicinity.png" src="_images/vicinity.png" />
<figcaption>
<p><span class="caption-text">Pore volume values for the (left) coarsened and (right) vicinity around the well INJ in the SPE10 model.</span><a class="headerlink" href="#id20" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="graphical-abstract">
<h2>Graphical abstract<a class="headerlink" href="#graphical-abstract" title="Link to this heading"></a></h2>
<p>Here we describe how to generate the geological model ilustrations in the <a class="reference external" href="https://github.com/cssr-tools/pycopm/blob/main/docs/text/figs/pycopm.png">graphical abstract</a>.
These five ilustrations are generated from the <a class="reference external" href="https://github.com/OPM/opm-tests/blob/master/drogon/model/DROGON_HIST.DATA">DROGON_HIST.DATA</a> model, and the
visualization is achieve using <a class="reference external" href="https://resinsight.org">ResInsight</a>.</p>
<ul class="simple">
<li><p>Top figure: By running the <a class="reference external" href="https://github.com/OPM/opm-tests/blob/master/drogon/model/DROGON_HIST.DATA">DROGON_HIST.DATA</a> using opm flow and visaluazing the static property pore volume.</p></li>
<li><p>Coarsenings: This corresponds to the generated DROGON_HIST_PYCOPM_PYCOPM.DATA deck in <a class="reference internal" href="#drogon"><span class="std std-ref">Drogon</span></a>.</p></li>
<li><p>Submodels: pycopm -i DROGON_HIST.DATA -v ‘xypolygon [463739,5931508] [464872,5932123] [464401,5932862] [463284,5932209] [463739,5931508]’ -w SUBMODELS -m all</p></li>
<li><p>Refinements: pycopm -i SUBMODELS.DATA -g 2,2,2 -w REFINEMENTS -m all</p></li>
<li><p>Transformations: pycopm -i DROGON_HIST.DATA -d ‘rotatexy 45’ -w TRANSFORMATIONS -m all</p></li>
</ul>
<p>Note that for ResInsight to show the wells, one needs to run the decks (e.g., flow REFINEMENTS.DATA).</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="configuration_file.html" class="btn btn-neutral float-left" title="Configuration file" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api.html" class="btn btn-neutral float-right" title="pycopm Python API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024-2025, NORCE Research AS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>