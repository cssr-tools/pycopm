#!/usr/bin/env python3
# SPDX-FileCopyrightText: 2024 NORCE
# SPDX-License-Identifier: GPL-3.0

"""
Script to write the rock permeability values
"""

import json


def perm_evaluation():
    """
    Permeability assignation
    """
    % if dic['rock'][i][1] > 0 and dic['mode'] in ["files","ert"]:
    with open("${dic['rock'][i][0]}.json") as f:
        C = json.load(f)
    % endif

    """Permeability assignation"""
    P = [0. for i in range(${len(dic['actnum_c'])})]
    % for k in range(len(dic['actnum_c'])):
    % if dic['rock'][i][1] > 0 and dic['mode'] in ["files","ert"]:
    % if dic['actnum_c'][k] == 1:
    P[${k}] = C["${dic['rock'][i][0]}${sum(dic['actnum_c'][0:k])}"]
    % else:
    P[${k}] = 0
    % endif
    % else:
    P[${k}] = ${k_c[k]}
    % endif
    % endfor

    with open("${dic['rock'][i][0]}.inc", "w") as f:
        f.write("-- This file was generated by pycopm https://github.com/cssr-tools/pycopm\n")
        f.write("${dic['rock'][i][0]}\n")
        for k in range(len(P)):
            f.write(f"{max(1e1,min(P[k],1e9)) :E} \n")
        f.write("/\n")

if __name__ == "__main__":
    perm_evaluation()
